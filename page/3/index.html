<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>菜菜的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="菜菜的博客">
<meta property="og:type" content="website">
<meta property="og:title" content="菜菜的博客">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="菜菜的博客">
<meta property="og:description" content="菜菜的博客">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="菜菜的博客">
<meta name="twitter:description" content="菜菜的博客">
  
    <link rel="alternative" href="/atom.xml" title="菜菜的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/ccz.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">菜菜</a></h1>
		</hgroup>

		
		<p class="header-subtitle">菜菜的博客</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						<li>Links</li>
						
						
						<li>About</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="/tags">标签</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="#" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="#" title="rss">rss</a>
					        
								<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/android/" style="font-size: 10px;">android</a> <a href="/tags/git/" style="font-size: 13.33px;">git</a> <a href="/tags/html5/" style="font-size: 10px;">html5</a> <a href="/tags/java/" style="font-size: 20px;">java</a> <a href="/tags/javascript/" style="font-size: 13.33px;">javascript</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/maven/" style="font-size: 10px;">maven</a> <a href="/tags/memcached/" style="font-size: 10px;">memcached</a> <a href="/tags/mongodb/" style="font-size: 10px;">mongodb</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/nodejs/" style="font-size: 10px;">nodejs</a> <a href="/tags/oracle/" style="font-size: 10px;">oracle</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/soa/" style="font-size: 16.67px;">soa</a> <a href="/tags/solr/" style="font-size: 10px;">solr</a> <a href="/tags/tomcat/" style="font-size: 10px;">tomcat</a> <a href="/tags/随笔/" style="font-size: 10px;">随笔</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.didispace.com">程序猿DD</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">我是谁，我从哪里来，我到哪里去？我就是我，是颜色不一样的吃货…</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">菜菜</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="/img/ccz.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">菜菜</h1>
			</hgroup>
			
			<p class="header-subtitle">菜菜的博客</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/tags">标签</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="#" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="#" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-SpringBoot构建RESTfulAPI与单元测试" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/15/SpringBoot构建RESTfulAPI与单元测试/" class="article-date">
  	<time datetime="2016-06-15T09:14:49.000Z" itemprop="datePublished">2016-06-15</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/15/SpringBoot构建RESTfulAPI与单元测试/">SpringBoot构建RESTfulAPI与单元测试</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Spring Boot构建RESTful API与单元测试<br>2016年03月13日 标签：Spring Boot<br>首先，回顾并详细说明一下在快速入门中使用的@Controller、@RestController、@RequestMapping注解。如果您对Spring MVC不熟悉并且还没有尝试过快速入门案例，建议先看一下快速入门的内容。</p>
<p>@Controller：修饰class，用来创建处理http请求的对象<br>@RestController：Spring4之后加入的注解，原来在@Controller中返回json需要@ResponseBody来配合，如果直接用@RestController替代@Controller就不需要再配置@ResponseBody，默认返回json格式。<br>@RequestMapping：配置url映射<br>下面我们尝试使用Spring MVC来实现一组对User对象操作的RESTful API，配合注释详细说明在Spring MVC中如何映射HTTP请求、如何传参、如何编写单元测试。</p>
<ul>
<li>RESTful API具体设计如下：*</li>
</ul>
<p>请求类型    URL    功能说明<br>GET    /users    查询用户列表<br>POST    /users    创建一个用户<br>GET    /users/id    根据id查询一个用户<br>PUT    /users/id    根据id更新一个用户<br>DELETE    /users/id    根据id删除一个用户<br>User实体定义：</p>
<p>public class User { </p>
<pre><code>private Long id; 
private String name; 
private Integer age; 

// 省略setter和getter 
</code></pre><p>}<br>实现对User对象的操作接口</p>
<p>@RestController<br>@RequestMapping(value=”/users”)     // 通过这里配置使下面的映射都在/users下<br>public class UserController { </p>
<pre><code>// 创建线程安全的Map 
static Map&lt;Long, User&gt; users = Collections.synchronizedMap(new HashMap&lt;Long, User&gt;()); 

@RequestMapping(value=&quot;/&quot;, method=RequestMethod.GET) 
public List&lt;User&gt; getUserList() { 
    // 处理&quot;/users/&quot;的GET请求，用来获取用户列表 
    // 还可以通过@RequestParam从页面中传递参数来进行查询条件或者翻页信息的传递 
    List&lt;User&gt; r = new ArrayList&lt;User&gt;(users.values()); 
    return r; 
} 

@RequestMapping(value=&quot;/&quot;, method=RequestMethod.POST) 
public String postUser(@ModelAttribute User user) { 
    // 处理&quot;/users/&quot;的POST请求，用来创建User 
    // 除了@ModelAttribute绑定参数之外，还可以通过@RequestParam从页面中传递参数 
    users.put(user.getId(), user); 
    return &quot;success&quot;; 
} 

@RequestMapping(value=&quot;/{id}&quot;, method=RequestMethod.GET) 
public User getUser(@PathVariable Long id) { 
    // 处理&quot;/users/{id}&quot;的GET请求，用来获取url中id值的User信息 
    // url中的id可通过@PathVariable绑定到函数的参数中 
    return users.get(id); 
} 

@RequestMapping(value=&quot;/{id}&quot;, method=RequestMethod.PUT) 
public String putUser(@PathVariable Long id, @ModelAttribute User user) { 
    // 处理&quot;/users/{id}&quot;的PUT请求，用来更新User信息 
    User u = users.get(id); 
    u.setName(user.getName()); 
    u.setAge(user.getAge()); 
    users.put(id, u); 
    return &quot;success&quot;; 
} 

@RequestMapping(value=&quot;/{id}&quot;, method=RequestMethod.DELETE) 
public String deleteUser(@PathVariable Long id) { 
    // 处理&quot;/users/{id}&quot;的DELETE请求，用来删除User 
    users.remove(id); 
    return &quot;success&quot;; 
} 
</code></pre><p>}<br>下面针对该Controller编写测试用例验证正确性，具体如下。当然也可以通过浏览器插件等进行请求提交验证。</p>
<p>@RunWith(SpringJUnit4ClassRunner.class)<br>@SpringApplicationConfiguration(classes = MockServletContext.class)<br>@WebAppConfiguration<br>public class ApplicationTests { </p>
<pre><code>private MockMvc mvc; 

@Before 
public void setUp() throws Exception { 
    mvc = MockMvcBuilders.standaloneSetup(new UserController()).build(); 
} 

@Test 
public void testUserController() throws Exception { 
    // 测试UserController 
    RequestBuilder request = null; 

    // 1、get查一下user列表，应该为空 
    request = get(&quot;/users/&quot;); 
    mvc.perform(request) 
            .andExpect(status().isOk()) 
            .andExpect(content().string(equalTo(&quot;[]&quot;))); 

    // 2、post提交一个user 
    request = post(&quot;/users/&quot;) 
            .param(&quot;id&quot;, &quot;1&quot;) 
            .param(&quot;name&quot;, &quot;测试大师&quot;) 
            .param(&quot;age&quot;, &quot;20&quot;); 
    mvc.perform(request) 
            .andExpect(content().string(equalTo(&quot;success&quot;))); 

    // 3、get获取user列表，应该有刚才插入的数据 
    request = get(&quot;/users/&quot;); 
    mvc.perform(request) 
            .andExpect(status().isOk()) 
            .andExpect(content().string(equalTo(&quot;[{\&quot;id\&quot;:1,\&quot;name\&quot;:\&quot;测试大师\&quot;,\&quot;age\&quot;:20}]&quot;))); 

    // 4、put修改id为1的user 
    request = put(&quot;/users/1&quot;) 
            .param(&quot;name&quot;, &quot;测试终极大师&quot;) 
            .param(&quot;age&quot;, &quot;30&quot;); 
    mvc.perform(request) 
            .andExpect(content().string(equalTo(&quot;success&quot;))); 

    // 5、get一个id为1的user 
    request = get(&quot;/users/1&quot;); 
    mvc.perform(request) 
            .andExpect(content().string(equalTo(&quot;{\&quot;id\&quot;:1,\&quot;name\&quot;:\&quot;测试终极大师\&quot;,\&quot;age\&quot;:30}&quot;))); 

    // 6、del删除id为1的user 
    request = delete(&quot;/users/1&quot;); 
    mvc.perform(request) 
            .andExpect(content().string(equalTo(&quot;success&quot;))); 

    // 7、get查一下user列表，应该为空 
    request = get(&quot;/users/&quot;); 
    mvc.perform(request) 
            .andExpect(status().isOk()) 
            .andExpect(content().string(equalTo(&quot;[]&quot;))); 

} 
</code></pre><p>}<br>至此，我们通过引入web模块（没有做其他的任何配置），就可以轻松利用Spring MVC的功能，以非常简洁的代码完成了对User对象的RESTful API的创建以及单元测试的编写。其中同时介绍了Spring MVC中最为常用的几个核心注解：@Controller,@RestController,RequestMapping以及一些参数绑定的注解：@PathVariable,@ModelAttribute,@RequestParam等。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-SpringBoot工程结构推荐" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/15/SpringBoot工程结构推荐/" class="article-date">
  	<time datetime="2016-06-15T09:13:54.000Z" itemprop="datePublished">2016-06-15</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/15/SpringBoot工程结构推荐/">SpringBoot工程结构推荐</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Spring Boot工程结构推荐<br>2016年03月05日 标签：Spring Boot<br>今天看了一位简书上朋友发来的工程，于是想到应该要写这么一篇。前人总结的最佳实践案例可以帮助我们免去很多不必要的麻烦。花点时间来看一下本文，绝对物超所值。<br>工程结构（最佳实践）<br>Spring Boot框架本身并没有对工程结构有特别的要求，但是按照最佳实践的工程结构可以帮助我们减少可能会遇见的坑，尤其是Spring包扫描机制的存在，如果您使用最佳实践的工程结构，可以免去不少特殊的配置工作。</p>
<p>典型示例<br>root package结构：com.example.myproject<br>应用主类Application.java置于root package下，通常我们会在应用主类中做一些框架配置扫描等配置，我们放在root package下可以帮助程序减少手工配置来加载到我们希望被Spring加载的内容<br>实体（Entity）与数据访问层（Repository）置于com.example.myproject.domain包下<br>逻辑层（Service）置于com.example.myproject.service包下<br>Web层（web）置于com.example.myproject.web包下<br>com<br>  +- example<br>    +- myproject<br>      +- Application.java<br>      |<br>      +- domain<br>      |  +- Customer.java<br>      |  +- CustomerRepository.java<br>      |<br>      +- service<br>      |  +- CustomerService.java<br>      |<br>      +- web<br>      |  +- CustomerController.java<br>      |<br>看看您现在的功能是否这样配置，如果不是，不妨尝试改变一下，看看是否可以去掉一些@Configuration配置？</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-SpringBoot开发Web应用" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/15/SpringBoot开发Web应用/" class="article-date">
  	<time datetime="2016-06-15T09:12:41.000Z" itemprop="datePublished">2016-06-15</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/15/SpringBoot开发Web应用/">SpringBoot开发Web应用</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Spring Boot开发Web应用<br>2016年03月03日 标签：Spring Boot<br>Spring Boot快速入门中我们完成了一个简单的RESTful Service，体验了快速开发的特性。在留言中也有朋友提到如何把处理结果渲染到页面上。那么本篇就在上篇基础上介绍一下如何进行Web应用的开发。<br>静态资源访问<br>在我们开发Web应用的时候，需要引用大量的js、css、图片等静态资源。</p>
<p>默认配置<br>Spring Boot默认提供静态资源目录位置需置于classpath下，目录名需符合如下规则：</p>
<p>/static<br>/public<br>/resources<br>/META-INF/resources<br>举例：我们可以在src/main/resources/目录下创建static，在该位置放置一个图片文件。启动程序后，尝试访问<a href="http://localhost:8080/D.jpg。如能显示图片，配置成功。" target="_blank" rel="external">http://localhost:8080/D.jpg。如能显示图片，配置成功。</a></p>
<p>渲染Web页面<br>在之前的示例中，我们都是通过@RestController来处理请求，所以返回的内容为json对象。那么如果需要渲染html页面的时候，要如何实现呢？</p>
<p>模板引擎<br>在动态HTML实现上Spring Boot依然可以完美胜任，并且提供了多种模板引擎的默认配置支持，所以在推荐的模板引擎下，我们可以很快的上手开发动态网站。</p>
<p>Spring Boot提供了默认配置的模板引擎主要有以下几种：</p>
<p>Thymeleaf<br>FreeMarker<br>Velocity<br>Groovy<br>Mustache<br>Spring Boot建议使用这些模板引擎，避免使用JSP，若一定要使用JSP将无法实现Spring Boot的多种特性，具体可见后文：支持JSP的配置</p>
<p>当你使用上述模板引擎中的任何一个，它们默认的模板配置路径为：src/main/resources/templates。当然也可以修改这个路径，具体如何修改，可在后续各模板引擎的配置属性中查询并修改。</p>
<p>Thymeleaf<br>Thymeleaf是一个XML/XHTML/HTML5模板引擎，可用于Web与非Web环境中的应用开发。它是一个开源的Java库，基于Apache License 2.0许可，由Daniel Fernández创建，该作者还是Java加密库Jasypt的作者。</p>
<p>Thymeleaf提供了一个用于整合Spring MVC的可选模块，在应用开发中，你可以使用Thymeleaf来完全代替JSP或其他模板引擎，如Velocity、FreeMarker等。Thymeleaf的主要目标在于提供一种可被浏览器正确显示的、格式良好的模板创建方式，因此也可以用作静态建模。你可以使用它创建经过验证的XML与HTML模板。相对于编写逻辑或代码，开发者只需将标签属性添加到模板中即可。接下来，这些标签属性就会在DOM（文档对象模型）上执行预先制定好的逻辑。</p>
<p>示例模板：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;table&gt;  </span><br><span class="line">  &lt;thead&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">      &lt;th th:text=&quot;#&#123;msgs.headers.name&#125;&quot;&gt;Name&lt;/td&gt;</span><br><span class="line">      &lt;th th:text=&quot;#&#123;msgs.headers.price&#125;&quot;&gt;Price&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">  &lt;/thead&gt;</span><br><span class="line">  &lt;tbody&gt;</span><br><span class="line">    &lt;tr th:each=&quot;prod : $&#123;allProducts&#125;&quot;&gt;</span><br><span class="line">      &lt;td th:text=&quot;$&#123;prod.name&#125;&quot;&gt;Oranges&lt;/td&gt;</span><br><span class="line">      &lt;td th:text=&quot;$&#123;#numbers.formatDecimal(prod.price,1,2)&#125;&quot;&gt;0.99&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">  &lt;/tbody&gt;</span><br><span class="line">&lt;/table&gt; </span><br><span class="line">``` </span><br><span class="line">可以看到Thymeleaf主要以属性的方式加入到html标签中，浏览器在解析html时，当检查到没有的属性时候会忽略，所以Thymeleaf的模板可以通过浏览器直接打开展现，这样非常有利于前后端的分离。</span><br><span class="line"></span><br><span class="line">在Spring Boot中使用Thymeleaf，只需要引入下面依赖，并在默认的模板路径src/main/resources/templates下编写模板文件即可完成。</span><br></pre></td></tr></table></figure></p>
<p><dependency><br>    <groupid>org.springframework.boot</groupid><br>    <artifactid>spring-boot-starter-thymeleaf</artifactid><br></dependency><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">在完成配置之后，举一个简单的例子，在快速入门工程的基础上，举一个简单的示例来通过Thymeleaf渲染一个页面。</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">public class HelloController &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/&quot;)</span><br><span class="line">    public String index(ModelMap map) &#123;</span><br><span class="line">        // 加入一个属性，用来在模板中读取</span><br><span class="line">        map.addAttribute(&quot;host&quot;, &quot;http://blog.didispace.com&quot;);</span><br><span class="line">        // return模板文件的名称，对应src/main/resources/templates/index.html</span><br><span class="line">        return &quot;index&quot;;  </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&lt;!DOCTYPE html&gt;  </p>
<p><html>  </html></p>
<p><head lang="en"><br>    <meta charset="UTF-8"><br>    <title></title><br></head>  </p>
<p><body>  </body></p>
<p></p><h1 th:text="${host}">Hello World</h1><br><br><br>```<br>如上页面，直接打开html页面展现Hello World，但是启动程序后，访问<a href="http://localhost:8080/，则是展示Controller中host的值：http://blog.didispace.com，做到了不破坏HTML自身内容的数据逻辑分离。" target="_blank" rel="external">http://localhost:8080/，则是展示Controller中host的值：http://blog.didispace.com，做到了不破坏HTML自身内容的数据逻辑分离。</a><p></p>
<p>更多Thymeleaf的页面语法，还请访问Thymeleaf的官方文档查询使用。</p>
<p>Thymeleaf的默认参数配置</p>
<p>如有需要修改默认配置的时候，只需复制下面要修改的属性到application.properties中，并修改成需要的值，如修改模板文件的扩展名，修改默认的模板路径等。</p>
<h1 id="Enable-template-caching"><a href="#Enable-template-caching" class="headerlink" title="Enable template caching."></a>Enable template caching.</h1><p>spring.thymeleaf.cache=true  </p>
<h1 id="Check-that-the-templates-location-exists"><a href="#Check-that-the-templates-location-exists" class="headerlink" title="Check that the templates location exists."></a>Check that the templates location exists.</h1><p>spring.thymeleaf.check-template-location=true  </p>
<h1 id="Content-Type-value"><a href="#Content-Type-value" class="headerlink" title="Content-Type value."></a>Content-Type value.</h1><p>spring.thymeleaf.content-type=text/html  </p>
<h1 id="Enable-MVC-Thymeleaf-view-resolution"><a href="#Enable-MVC-Thymeleaf-view-resolution" class="headerlink" title="Enable MVC Thymeleaf view resolution."></a>Enable MVC Thymeleaf view resolution.</h1><p>spring.thymeleaf.enabled=true  </p>
<h1 id="Template-encoding"><a href="#Template-encoding" class="headerlink" title="Template encoding."></a>Template encoding.</h1><p>spring.thymeleaf.encoding=UTF-8  </p>
<h1 id="Comma-separated-list-of-view-names-that-should-be-excluded-from-resolution"><a href="#Comma-separated-list-of-view-names-that-should-be-excluded-from-resolution" class="headerlink" title="Comma-separated list of view names that should be excluded from resolution."></a>Comma-separated list of view names that should be excluded from resolution.</h1><p>spring.thymeleaf.excluded-view-names=  </p>
<h1 id="Template-mode-to-be-applied-to-templates-See-also-StandardTemplateModeHandlers"><a href="#Template-mode-to-be-applied-to-templates-See-also-StandardTemplateModeHandlers" class="headerlink" title="Template mode to be applied to templates. See also StandardTemplateModeHandlers."></a>Template mode to be applied to templates. See also StandardTemplateModeHandlers.</h1><p>spring.thymeleaf.mode=HTML5  </p>
<h1 id="Prefix-that-gets-prepended-to-view-names-when-building-a-URL"><a href="#Prefix-that-gets-prepended-to-view-names-when-building-a-URL" class="headerlink" title="Prefix that gets prepended to view names when building a URL."></a>Prefix that gets prepended to view names when building a URL.</h1><p>spring.thymeleaf.prefix=classpath:/templates/  </p>
<h1 id="Suffix-that-gets-appended-to-view-names-when-building-a-URL"><a href="#Suffix-that-gets-appended-to-view-names-when-building-a-URL" class="headerlink" title="Suffix that gets appended to view names when building a URL."></a>Suffix that gets appended to view names when building a URL.</h1><p>spring.thymeleaf.suffix=.html  spring.thymeleaf.template-resolver-order= # Order of the template resolver in the chain. spring.thymeleaf.view-names= # Comma-separated list of view names that can be resolved.<br>支持JSP的配置<br>Spring Boot并不建议使用，但如果一定要使用，可以参考此工程作为脚手架：JSP支持</p>
<p>Spring Boot教程完整案例</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-SpringBoot中使用SpringSecurity进行安全控制" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/15/SpringBoot中使用SpringSecurity进行安全控制/" class="article-date">
  	<time datetime="2016-06-15T09:10:41.000Z" itemprop="datePublished">2016-06-15</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/15/SpringBoot中使用SpringSecurity进行安全控制/">SpringBoot中使用SpringSecurity进行安全控制</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Spring Boot中使用Spring Security进行安全控制<br>2016年05月28日 标签：Spring Boot, Spring Security<br>我们在编写Web应用时，经常需要对页面做一些安全控制，比如：对于没有访问权限的用户需要转到登录表单页面。要实现访问控制的方法多种多样，可以通过Aop、拦截器实现，也可以通过框架实现（如：Apache Shiro、Spring Security）。</p>
<p>本文将具体介绍在Spring Boot中如何使用Spring Security进行安全控制。</p>
<p>准备工作<br>首先，构建一个简单的Web工程，以用于后续添加安全控制，也可以用之前Chapter3-1-2做为基础工程。若对如何使用Spring Boot构建Web应用，可以先阅读《Spring Boot开发Web应用》一文。</p>
<p>Web层实现请求映射<br>@Controller<br>public class HelloController {</p>
<pre><code>@RequestMapping(&quot;/&quot;)
public String index() {
    return &quot;index&quot;;
}

@RequestMapping(&quot;/hello&quot;)
public String hello() {
    return &quot;hello&quot;;
}
</code></pre><p>}<br>/：映射到index.html<br>/hello：映射到hello.html<br>实现映射的页面<br>src/main/resources/templates/index.html<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;  </span><br><span class="line">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xmlns:th=&quot;http://www.thymeleaf.org&quot; xmlns:sec=&quot;http://www.thymeleaf.org/thymeleaf-extras-springsecurity3&quot;&gt;  </span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;Spring Security入门&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;h1&gt;欢迎使用Spring Security!&lt;/h1&gt;</span><br><span class="line">        &lt;p&gt;点击 &lt;a th:href=&quot;@&#123;/hello&#125;&quot;&gt;这里&lt;/a&gt; 打个招呼吧&lt;/p&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p>src/main/resources/templates/hello.html<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;  </span><br><span class="line">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xmlns:th=&quot;http://www.thymeleaf.org&quot;  </span><br><span class="line">      xmlns:sec=&quot;http://www.thymeleaf.org/thymeleaf-extras-springsecurity3&quot;&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;Hello World!&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;h1&gt;Hello world!&lt;/h1&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p>可以看到在index.html中提供到/hello的链接，显然在这里没有任何安全控制，所以点击链接后就可以直接跳转到hello.html页面。</p>
<p>整合Spring Security<br>在这一节，我们将对/hello页面进行权限控制，必须是授权用户才能访问。当没有权限的用户访问后，跳转到登录页面。</p>
<p>添加依赖<br>在pom.xml中添加如下配置，引入对Spring Security的依赖。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;  </span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;  </span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure></p>
<p>Spring Security配置<br>创建Spring Security的配置类WebSecurityConfig，具体如下：</p>
<p>@Configuration<br>@EnableWebSecurity<br>public class WebSecurityConfig extends WebSecurityConfigurerAdapter {</p>
<pre><code>@Override
protected void configure(HttpSecurity http) throws Exception {
    http
        .authorizeRequests()
            .antMatchers(&quot;/&quot;, &quot;/home&quot;).permitAll()
            .anyRequest().authenticated()
            .and()
        .formLogin()
            .loginPage(&quot;/login&quot;)
            .permitAll()
            .and()
        .logout()
            .permitAll();
}

@Autowired
public void configureGlobal(AuthenticationManagerBuilder auth) throws Exception {
    auth
        .inMemoryAuthentication()
            .withUser(&quot;user&quot;).password(&quot;password&quot;).roles(&quot;USER&quot;);
}
</code></pre><p>}<br>通过@EnableWebSecurity注解开启Spring Security的功能<br>继承WebSecurityConfigurerAdapter，并重写它的方法来设置一些web安全的细节<br>configure(HttpSecurity http)方法<br>通过authorizeRequests()定义哪些URL需要被保护、哪些不需要被保护。例如以上代码指定了/和/home不需要任何认证就可以访问，其他的路径都必须通过身份验证。<br>通过formLogin()定义当需要用户登录时候，转到的登录页面。<br>configureGlobal(AuthenticationManagerBuilder auth)方法，在内存中创建了一个用户，该用户的名称为user，密码为password，用户角色为USER。<br>新增登录请求与页面<br>在完成了Spring Security配置之后，我们还缺少登录的相关内容。</p>
<p>HelloController中新增/login请求映射至login.html</p>
<p>@Controller<br>public class HelloController {</p>
<pre><code>// 省略之前的内容...

@RequestMapping(&quot;/login&quot;)
public String login() {
    return &quot;login&quot;;
}
</code></pre><p>}<br>新增登录页面：src/main/resources/templates/login.html<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;  </span><br><span class="line">      xmlns:th=&quot;http://www.thymeleaf.org&quot;</span><br><span class="line">      xmlns:sec=&quot;http://www.thymeleaf.org/thymeleaf-extras-springsecurity3&quot;&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;Spring Security Example &lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;div th:if=&quot;$&#123;param.error&#125;&quot;&gt;</span><br><span class="line">            用户名或密码错</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div th:if=&quot;$&#123;param.logout&#125;&quot;&gt;</span><br><span class="line">            您已注销成功</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;form th:action=&quot;@&#123;/login&#125;&quot; method=&quot;post&quot;&gt;</span><br><span class="line">            &lt;div&gt;&lt;label&gt; 用户名 : &lt;input type=&quot;text&quot; name=&quot;username&quot;/&gt; &lt;/label&gt;&lt;/div&gt;</span><br><span class="line">            &lt;div&gt;&lt;label&gt; 密  码 : &lt;input type=&quot;password&quot; name=&quot;password&quot;/&gt; &lt;/label&gt;&lt;/div&gt;</span><br><span class="line">            &lt;div&gt;&lt;input type=&quot;submit&quot; value=&quot;登录&quot;/&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">```  </span><br><span class="line">可以看到，实现了一个简单的通过用户名和密码提交到/login的登录方式。</span><br><span class="line"></span><br><span class="line">根据配置，Spring Security提供了一个过滤器来拦截请求并验证用户身份。如果用户身份认证失败，页面就重定向到/login?error，并且页面中会展现相应的错误信息。若用户想要注销登录，可以通过访问/login?logout请求，在完成注销之后，页面展现相应的成功消息。</span><br><span class="line"></span><br><span class="line">到这里，我们启用应用，并访问http://localhost:8080/，可以正常访问。但是访问http://localhost:8080/hello的时候被重定向到了http://localhost:8080/login页面，因为没有登录，用户没有访问权限，通过输入用户名user和密码password进行登录后，跳转到了Hello World页面，再也通过访问http://localhost:8080/login?logout，就可以完成注销操作。</span><br><span class="line"></span><br><span class="line">为了让整个过程更完成，我们可以修改hello.html，让它输出一些内容，并提供“注销”的链接。</span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xmlns:th=&quot;http://www.thymeleaf.org&quot;  </span><br><span class="line">      xmlns:sec=&quot;http://www.thymeleaf.org/thymeleaf-extras-springsecurity3&quot;&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;Hello World!&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;h1 th:inline=&quot;text&quot;&gt;Hello [[$&#123;#httpServletRequest.remoteUser&#125;]]!&lt;/h1&gt;</span><br><span class="line">        &lt;form th:action=&quot;@&#123;/logout&#125;&quot; method=&quot;post&quot;&gt;</span><br><span class="line">            &lt;input type=&quot;submit&quot; value=&quot;注销&quot;/&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p>本文通过一个最简单的示例完成了对Web应用的安全控制，Spring Security提供的功能还远不止于此，更多Spring Security的使用可参见Spring Security Reference。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="springboot中使用spring-Security进行安全控制-1" class="article article-type-springboot中使用spring" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/15/Security进行安全控制-1/" class="article-date">
  	<time datetime="2016-06-15T09:10:30.000Z" itemprop="datePublished">2016-06-15</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/15/Security进行安全控制-1/">Security进行安全控制</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-SpringBoot快速入门" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/15/SpringBoot快速入门/" class="article-date">
  	<time datetime="2016-06-15T09:03:05.000Z" itemprop="datePublished">2016-06-15</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/15/SpringBoot快速入门/">SpringBoot快速入门</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Spring Boot快速入门<br>2016年02月26日 标签：Spring Boot<br>简介<br>在您第1次接触和学习Spring框架的时候，是否因为其繁杂的配置而退却了？在你第n次使用Spring框架的时候，是否觉得一堆反复黏贴的配置有一些厌烦？那么您就不妨来试试使用Spring Boot来让你更易上手，更简单快捷地构建Spring应用！</p>
<p>Spring Boot让我们的Spring应用变的更轻量化。比如：你可以仅仅依靠一个Java类来运行一个Spring引用。你也可以打包你的应用为jar并通过使用java -jar来运行你的Spring Web应用。</p>
<p>Spring Boot的主要优点：</p>
<p>为所有Spring开发者更快的入门<br>开箱即用，提供各种默认配置来简化项目配置<br>内嵌式容器简化Web项目<br>没有冗余代码生成和XML配置的要求<br>快速入门<br>本章主要目标完成Spring Boot基础项目的构建，并且实现一个简单的Http请求处理，通过这个例子对Spring Boot有一个初步的了解，并体验其结构简单、开发快速的特性。</p>
<p>系统要求：<br>Java 7及以上<br>Spring Framework 4.1.5及以上<br>本文采用Java 1.8.0_73、Spring Boot 1.3.2调试通过。</p>
<p>使用Maven构建项目<br>通过SPRING INITIALIZR工具产生基础项目<br>访问：<a href="http://start.spring.io/" target="_blank" rel="external">http://start.spring.io/</a><br>选择构建工具Maven Project、Spring Boot版本1.3.2以及一些工程基本信息，可参考下图所示<br><img src="http://blog.didispace.com/content/images/2016/02/chapter1-1.png"><br>点击Generate Project下载项目压缩包<br>解压项目包，并用IDE以Maven项目导入，以IntelliJ IDEA 14为例：<br>菜单中选择File–&gt;New–&gt;Project from Existing Sources…<br>选择解压后的项目文件夹，点击OK<br>点击Import project from external model并选择Maven，点击Next到底为止。<br>若你的环境有多个版本的JDK，注意到选择Java SDK的时候请选择Java 7以上的版本<br>项目结构解析<br><img src="http://blog.didispace.com/content/images/2016/02/chapter1-2.png"><br>项目结构</p>
<p>通过上面步骤完成了基础项目的创建，如上图所示，Spring Boot的基础结构共三个文件（具体路径根据用户生成项目时填写的Group所有差异）：</p>
<p>src/main/java下的程序入口：Chapter1Application<br>src/main/resources下的配置文件：application.properties<br>src/test/下的测试入口：Chapter1ApplicationTests<br>生成的Chapter1Application和Chapter1ApplicationTests类都可以直接运行来启动当前创建的项目，由于目前该项目未配合任何数据访问或Web模块，程序会在加载完Spring之后结束运行。</p>
<p>引入Web模块<br>当前的pom.xml内容如下，仅引入了两个模块：</p>
<p>spring-boot-starter：核心模块，包括自动配置支持、日志和YAML<br>spring-boot-starter-test：测试模块，包括JUnit、Hamcrest、Mockito<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;  </span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">        &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure></p>
<p>引入Web模块，需添加spring-boot-starter-web模块：</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre><p>编写HelloWorld服务<br>创建package命名为com.didispace.web（根据实际情况修改）<br>创建HelloController类，内容如下<br>@RestController<br>public class HelloController {</p>
<pre><code>@RequestMapping(&quot;/hello&quot;)
public String index() {
    return &quot;Hello World&quot;;
}
</code></pre><p>}<br>启动主程序，打开浏览器访问<a href="http://localhost:8080/hello，可以看到页面输出Hello" target="_blank" rel="external">http://localhost:8080/hello，可以看到页面输出Hello</a> World<br>编写单元测试用例<br>打开的src/test/下的测试入口Chapter1ApplicationTests类。下面编写一个简单的单元测试来模拟http请求，具体如下：</p>
<p>@RunWith(SpringJUnit4ClassRunner.class)<br>@SpringApplicationConfiguration(classes = MockServletContext.class)<br>@WebAppConfiguration<br>public class Chapter1ApplicationTests {</p>
<pre><code>private MockMvc mvc;

@Before
public void setUp() throws Exception {
    mvc = MockMvcBuilders.standaloneSetup(new HelloController()).build();
}

@Test
public void getHello() throws Exception {
    mvc.perform(MockMvcRequestBuilders.get(&quot;/hello&quot;).accept(MediaType.APPLICATION_JSON))
            .andExpect(status().isOk())
            .andExpect(content().string(equalTo(&quot;Hello World&quot;)));
}
</code></pre><p>}<br>使用MockServletContext来构建一个空的WebApplicationContext，这样我们创建的HelloController就可以在@Before函数中创建并传递到MockMvcBuilders.standaloneSetup（）函数中。</p>
<p>注意引入下面内容，让status、content、equalTo函数可用<br>import static org.hamcrest.Matchers.equalTo;<br>import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;<br>import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;<br>至此已完成目标，通过Maven构建了一个空白Spring Boot项目，再通过引入web模块实现了一个简单的请求处理。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-各大平台免费接口" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/12/各大平台免费接口/" class="article-date">
  	<time datetime="2016-06-12T02:18:34.000Z" itemprop="datePublished">2016-06-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/12/各大平台免费接口/">各大平台免费接口</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>电商接口</p>
<p>京东获取单个商品价格接口：<br><a href="http://p.3.cn/prices/mgets?skuIds=J_商品ID&amp;type=1" target="_blank" rel="external">http://p.3.cn/prices/mgets?skuIds=J_商品ID&amp;type=1</a><br>ps:商品ID这么获取:<a href="http://item.jd.com/954086.html" target="_blank" rel="external">http://item.jd.com/954086.html</a></p>
<p>物流接口</p>
<p>快递接口：<br><a href="http://www.kuaidi100.com/query?type=快递公司代号&amp;postid=快递单号" target="_blank" rel="external">http://www.kuaidi100.com/query?type=快递公司代号&amp;postid=快递单号</a><br>ps:快递公司编码:申通=”shentong” EMS=”ems” 顺丰=”shunfeng” 圆通=”yuantong” 中通=”zhongtong” 韵达=”yunda” 天天=”tiantian” 汇通=”huitongkuaidi” 全峰=”quanfengkuaidi” 德邦=”debangwuliu” 宅急送=”zhaijisong”</p>
<p>谷歌接口</p>
<p>FeedXml转json接口：<br><a href="http://ajax.googleapis.com/ajax/services/feed/load?q=Feed地址&amp;v=1.0" target="_blank" rel="external">http://ajax.googleapis.com/ajax/services/feed/load?q=Feed地址&amp;v=1.0</a><br>备选参数:callback：&amp;callback=foo就会在json外面嵌套foo({})方便做jsonp使用。<br>备选参数:n：返回多少条记录。</p>
<p>天气接口</p>
<p>百度接口：<br><a href="http://api.map.baidu.com/telematics/v3/weather?location=嘉兴&amp;output=json&amp;ak=5slgyqGDENN7Sy7pw29IUvrZ" target="_blank" rel="external">http://api.map.baidu.com/telematics/v3/weather?location=嘉兴&amp;output=json&amp;ak=5slgyqGDENN7Sy7pw29IUvrZ</a><br>location:城市名或经纬度 ak:开发者密钥 output:默认xml</p>
<p>气象局接口：<br><a href="http://m.weather.com.cn/data/101010100.html" target="_blank" rel="external">http://m.weather.com.cn/data/101010100.html</a></p>
<p>音乐接口</p>
<p>虾米接口：<br><a href="http://kuang.xiami.com/app/nineteen/search/key/歌曲名称/diandian/1/page/歌曲当前页?_=当前毫秒&amp;callback=getXiamiData" target="_blank" rel="external">http://kuang.xiami.com/app/nineteen/search/key/歌曲名称/diandian/1/page/歌曲当前页?_=当前毫秒&amp;callback=getXiamiData</a></p>
<p>QQ空间音乐接口：<br><a href="http://qzone-music.qq.com/fcg-bin/cgi_playlist_xml.fcg?uin=QQ号码&amp;json=1&amp;g_tk=1916754934" target="_blank" rel="external">http://qzone-music.qq.com/fcg-bin/cgi_playlist_xml.fcg?uin=QQ号码&amp;json=1&amp;g_tk=1916754934</a></p>
<p>QQ空间收藏音乐接口：<br><a href="http://qzone-music.qq.com/fcg-bin/fcg_music_fav_getinfo.fcg?dirinfo=0&amp;dirid=1&amp;uin=QQ号&amp;p=0.519638272547262&amp;g_tk=1284234856" target="_blank" rel="external">http://qzone-music.qq.com/fcg-bin/fcg_music_fav_getinfo.fcg?dirinfo=0&amp;dirid=1&amp;uin=QQ号&amp;p=0.519638272547262&amp;g_tk=1284234856</a></p>
<p>多米音乐接口：<br><a href="http://v5.pc.duomi.com/search-ajaxsearch-searchall?kw=关键字&amp;pi=页码&amp;pz=每页音乐数" target="_blank" rel="external">http://v5.pc.duomi.com/search-ajaxsearch-searchall?kw=关键字&amp;pi=页码&amp;pz=每页音乐数</a></p>
<p>soso接口：<br><a href="http://cgi.music.soso.com/fcgi-bin/fcg_search_xmldata.q?source=10&amp;w=关键字&amp;perpage=1&amp;ie=utf-8" target="_blank" rel="external">http://cgi.music.soso.com/fcgi-bin/fcg_search_xmldata.q?source=10&amp;w=关键字&amp;perpage=1&amp;ie=utf-8</a></p>
<p>视频接口</p>
<p>土豆接口：<br><a href="http://api.tudou.com/v3/gw?method=album.item.get&amp;appKey=Appkey&amp;format=json&amp;albumId=视频剧集ID&amp;pageNo=当前页&amp;pageSize=每页显示" target="_blank" rel="external">http://api.tudou.com/v3/gw?method=album.item.get&amp;appKey=Appkey&amp;format=json&amp;albumId=视频剧集ID&amp;pageNo=当前页&amp;pageSize=每页显示</a></p>
<p>地图接口</p>
<p>阿里云根据地区名获取经纬度接口：<br><a href="http://gc.ditu.aliyun.com/geocoding?a=苏州市" target="_blank" rel="external">http://gc.ditu.aliyun.com/geocoding?a=苏州市</a><br>参数解释: 纬度,经度type 001 (100代表道路，010代表POI，001代表门址，111可以同时显示前三项)</p>
<p>阿里云根据经纬度获取地区名接口：<br><a href="http://gc.ditu.aliyun.com/regeocoding?l=39.938133,116.395739&amp;type=001" target="_blank" rel="external">http://gc.ditu.aliyun.com/regeocoding?l=39.938133,116.395739&amp;type=001</a></p>
<p>IP接口</p>
<p>新浪接口（ip值为空的时候 获取本地的）：<br><a href="http://int.dpool.sina.com.cn/iplookup/iplookup.php?format=json&amp;ip=218.4.255.255" target="_blank" rel="external">http://int.dpool.sina.com.cn/iplookup/iplookup.php?format=json&amp;ip=218.4.255.255</a></p>
<p>淘宝接口：<br><a href="http://ip.taobao.com/service/getIpInfo.php?ip=63.223.108.42" target="_blank" rel="external">http://ip.taobao.com/service/getIpInfo.php?ip=63.223.108.42</a></p>
<p>手机信息查询接口</p>
<p>淘宝网接口：<br><a href="http://tcc.taobao.com/cc/json/mobile_tel_segment.htm?tel=手机号" target="_blank" rel="external">http://tcc.taobao.com/cc/json/mobile_tel_segment.htm?tel=手机号</a></p>
<p>拍拍接口：<br><a href="http://virtual.paipai.com/extinfo/GetMobileProductInfo?mobile=手机号&amp;amount=10000&amp;callname=getPhoneNumInfoExtCallback" target="_blank" rel="external">http://virtual.paipai.com/extinfo/GetMobileProductInfo?mobile=手机号&amp;amount=10000&amp;callname=getPhoneNumInfoExtCallback</a> 用例</p>
<p>百付宝接口：<br><a href="https://www.baifubao.com/callback?cmd=1059&amp;callback=phone&amp;phone=手机号" target="_blank" rel="external">https://www.baifubao.com/callback?cmd=1059&amp;callback=phone&amp;phone=手机号</a></p>
<p>115接口：<br><a href="http://cz.115.com/?ct=index&amp;ac=get_mobile_local&amp;callback=jsonp1333962541001&amp;mobile=手机号" target="_blank" rel="external">http://cz.115.com/?ct=index&amp;ac=get_mobile_local&amp;callback=jsonp1333962541001&amp;mobile=手机号</a></p>
<p>有道接口：<br><a href="http://www.youdao.com/smartresult-xml/search.s?jsFlag=true&amp;type=mobile&amp;q=手机号" target="_blank" rel="external">http://www.youdao.com/smartresult-xml/search.s?jsFlag=true&amp;type=mobile&amp;q=手机号</a></p>
<p>手机在线接口<br><a href="http://api.showji.com/Locating/www.showji.com.aspx?m=手机号&amp;output=json&amp;callback=querycallback" target="_blank" rel="external">http://api.showji.com/Locating/www.showji.com.aspx?m=手机号&amp;output=json&amp;callback=querycallback</a></p>
<p>视频信息接口</p>
<p>优酷：<br><a href="http://v.youku.com/player/getPlayList/VideoIDS/视频ID" target="_blank" rel="external">http://v.youku.com/player/getPlayList/VideoIDS/视频ID</a><br>(比如 <a href="http://v.youku.com/v_show/id_XNTQxNzc4ODg0.html的ID就是XNTQxNzc4ODg0" target="_blank" rel="external">http://v.youku.com/v_show/id_XNTQxNzc4ODg0.html的ID就是XNTQxNzc4ODg0</a>)</p>
<p>翻译、词典接口</p>
<p>腾讯：<br><a href="http://dict.qq.com/dict?q=词语" target="_blank" rel="external">http://dict.qq.com/dict?q=词语</a></p>
<p>腾讯的部分接口</p>
<p>获取QQ昵称和用户头像：<br><a href="http://r.qzone.qq.com/cgi-bin/user/cgi_personal_card?uin=QQ" target="_blank" rel="external">http://r.qzone.qq.com/cgi-bin/user/cgi_personal_card?uin=QQ</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-如何使用GoEasy实现web实时推送" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/05/如何使用GoEasy实现web实时推送/" class="article-date">
  	<time datetime="2016-06-05T06:32:58.000Z" itemprop="datePublished">2016-06-05</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/05/如何使用GoEasy实现web实时推送/">如何使用GoEasy实现web实时推送</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>之前项目需要做一个推送功能，最开始我没有想过用第三方推送服务。想着可以用已知技术方式完成，例如定时到服务器看看是否有新的消息，有的话，就读取下来并显示，但是这种方式很浪费客户以及服务器的资源，当然这种方式在我们项目里是不可取的。再后来我在网上搜了一些，说是可以用web socket实现我的功能，但是我在网上查了一下使用方式，看了一上午一头雾水。即使我可以一周两周内用websocket实现我的推送，那我又拿什么来保证我自己写的推送程序的到达率和速度呢？维护成本一定也会随着增加！况且我们也不允许花太多开发成本在这个项目上！</p>
<p>经过上面的一番周折后，我跟项目组提出使用第三方的推送服务，原因很简单，第三方推送服务可以满足我们的需求，缩短我们的开发测试维护成本，术业有专攻，它们在推送方面更有优势，服务质量也有保证！经过几番对比后，我们最终决定使用了GoEasy推送。 它真正的从根本上解决了我们的问题！对于他们的服务质量很满意，注册成功后，你可以获得他们的联系方式，问题处理得很及时，不像有些公司的客服，发封邮件好几天都没有任何信息！从而也解决了我们的后顾之忧！</p>
<p>GoEasy实现向特定用户群推送的原理:<br>知道了他们的推送原理，可以更加方便我们了解他们的服务，以及理解我们写的代码。其实原理很简单，只需要确定哪些用户需要接收信息，然后让这些用户都订阅一个相同的channel（频道）。 然后再往这个平台上推送消息即可！所有关键在于channel，channel一致，则可以接收到信息，否则收不到！</p>
<p>对于订阅必须要的信息有：Appkey, channel<br>对于推送必须要的信息有：Appkey, channel, content</p>
<p>废话不多说，直接进入正题，如何实现：</p>
<p>从GoEasy获取appkey<br>appkey是验证用户的有效性的唯一标识。<br>注册账号: GoEasy官网：<a href="https://goeasy.io" target="_blank" rel="external">https://goeasy.io</a><br>用注册好的账号登录到GoEasy的后台管理系统，创建您自己应用（application）.<br>Application创建好之后系统会自动为您生成appkey<br>系统会生成两个keys，一个Super key和一个Subscribe key；它们的区别在于前者既可以订阅又可以推送，但后者只能用于订阅。</p>
<p>用GoEasy实现订阅（接收）的实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;https://cdn.goeasy.io/goeasy.js&quot;&gt;&lt;/script&gt;     </span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    var goEasy = new GoEasy(&#123;appkey: &apos;your appkey&apos;&#125;);</span><br><span class="line">    goEasy.subscribe(&#123;</span><br><span class="line">        channel: &apos;your_channel&apos;,</span><br><span class="line">        onMessage: function(message)&#123;</span><br><span class="line">            alert(&apos;接收到消息:&apos;+message.content);//拿到了信息之后，你可以做你任何想做的事</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<p>有了这几行代码后，只要保证网络畅通的情况下，页面会自动弹出你从任何平台上推送的信息。</p>
<p>用GoEasy的三种方式实现推送及接收<br>目前GoEasy支持三种推送方式： Java后台推送（它们有提供JAVA SDK和 maven远程仓库）， JS推送，RestAPI推送（有了RestAPI，我们就可以用PHP, .NET, Ruby…来推送信息了，很方便）</p>
<p>说了这么多，来我们看一下怎么用GoEasy的三种方式分别实现推送吧.</p>
<p>用GoEasy SDK推送<br>引入GoEasy SDK<br>方式一，直接在goeasy的官网上进行下载<br>GoEasy SDK下载链接：<a href="http://maven.goeasy.io/service/local/artifact/maven/redirect?r=releases&amp;g=io.goeasy&amp;a=goeasy-sdk&amp;v=LATEST&amp;e=jar" target="_blank" rel="external">http://maven.goeasy.io/service/local/artifact/maven/redirect?r=releases&amp;g=io.goeasy&amp;a=goeasy-sdk&amp;v=LATEST&amp;e=jar</a><br>方式二，用maven远程库直接导入到项目中，下面是GoEasy远程maven库的配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;repository&gt;</span><br><span class="line">    &lt;id&gt;goeasy&lt;/id&gt;</span><br><span class="line">    &lt;name&gt;goeasy&lt;/name&gt;</span><br><span class="line">    &lt;url&gt;http://maven.goeasy.io/content/repositories/releases/&lt;/url&gt;</span><br><span class="line">&lt;/repository&gt;</span><br><span class="line">…</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;io.goeasy&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;goeasy-sdk&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.3.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<p>实例化GoEasy对象并推送<br>GoEasy goEasy = new GoEasy(“your appkey”);<br>goEasy.publish(‘your_channel’, ‘First message’);<br>JavaScript推送<br>引入goeasy.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;https://cdn.goeasy.io/goeasy.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<p>实例化Goeasy对象，并用publish函数进行推送<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    var goEasy = new GoEasy(&#123;appkey: &apos;your appkey&apos;&#125;);</span><br><span class="line">    goEasy. publish (&#123;</span><br><span class="line">        channel: &apos;your_channel&apos;, </span><br><span class="line">        message: &apos;Second message！&apos;</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<p>用RestAPI进行推送<br>URL: <a href="https://goeasy.io/goeasy/publish" target="_blank" rel="external">https://goeasy.io/goeasy/publish</a><br>Method: post<br>参数：appkey, channel, content<br>例如：<a href="https://goeasy.io/goeasy/publish?appkey={your_appkey}&amp;channel={your_channel}&amp;content={your_message}" target="_blank" rel="external">https://goeasy.io/goeasy/publish?appkey={your_appkey}&amp;channel={your_channel}&amp;content={your_message}</a><br>GoEasy官网：<a href="https://goeasy.io" target="_blank" rel="external">https://goeasy.io</a><br>快速入门：<a href="https://goeasy.io/www/started.jsp" target="_blank" rel="external">https://goeasy.io/www/started.jsp</a><br>文档下载：<a href="https://goeasy.io/www/docs.jsp" target="_blank" rel="external">https://goeasy.io/www/docs.jsp</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-汽车之家配置管理系统AutoCMS" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/05/03/汽车之家配置管理系统AutoCMS/" class="article-date">
  	<time datetime="2016-05-03T08:49:37.000Z" itemprop="datePublished">2016-05-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/03/汽车之家配置管理系统AutoCMS/">汽车之家配置管理系统AutoCMS</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Break Wang<br>Be slow to promise and quick to perform.</p>
<p> Email<br> Twitter<br> Google+<br>汽车之家配置管理系统AutoCMS</p>
<p>介绍</p>
<p>作者介绍</p>
<p>本文作者是王显宝wangxianbao@autohome.com.cn,主要负责AutoCMS的开发工作和缓存平台的运维工作，擅长python自动化运维,分布式缓存和分布式文件系统应用管理。</p>
<p>团队介绍</p>
<p>我们是汽车之家运维团队，是汽车之家技术部里最为核心的团队，由op和dev共同组成。我们的目标是为汽车之家集团打造一个高性能，高可扩展，低成本，并且稳定可靠的网站基础设施平台。</p>
<p>团队技术博客地址为 <a href="http://autohomeops.github.io/" target="_blank" rel="external">http://autohomeops.github.io/</a></p>
<p>联系方式：可以通过邮件或者在官方技术博客留言跟我们交流。</p>
<p>大纲</p>
<ol>
<li>前言</li>
<li>AutoCMS使用方法介绍</li>
<li>系统架构说明</li>
<li>配置案例</li>
<li>小结<br>1.前言</li>
</ol>
<p>AutoCMS 是汽车之家目前正在使用的统一配置管理工具，本文将详细介绍该系统的使用方法和架构实现。 先来回顾下汽车之家软件部署和配置文件管理的经历的几个阶段:</p>
<p>原始阶段（依靠手工部署，wiki制定规范）<br>最初阶段软件部署和配置文件管理完全依赖人力完成。部署新业务，运维根据研发测试环境的软件版本，去官网下载软件包，在服务器上编译安装，然后根据研发需求，手工配置文件，启动服务。该阶段暴露出诸多问题：<br>软件包的来源没有强制规范，带来了很大的安全隐患。<br>新业务上线或者业务紧急扩容，运维投入大量人力来完成繁重的体力劳动。<br>部署目录标准化依赖wiki规范维护，人力部署的时候经常会出现问题<br>半自动化阶段（依赖人力打包，yum方式部署）<br>随着运维自动化的推行，搭建自己的yum源，自己打包来规范软件版本来源和部署目录。需要批量部署的时候，逐台登录服务器执行yum install 安装相关的软件包即可，该阶段已经节省了很大的人力，不过依然需要逐台登录服务器去修改配置文件才能够满足上线需求。配置文件变更前的备份和故障后的恢复依然需要人力维护。<br>自动化阶段<br>现在正在使用的管理系统AutoCMS，实现页面化管理软件部署和配置文件，实现快速批量管理软件。<br>下面将详细介绍一下我们正在使用的AutoCMS。</p>
<p>2.AutoCMS使用方法介绍</p>
<p>AutoCMS 是基于puppet实现的软件部署和配置文件管理的一套系统，避免手动安装部署软件，提供可靠的软件标准化部署，配置文件和基础服务的管理服务。 本系统主要实现以下几点功能：</p>
<p>批量部署软件包<br>页面管理软件的配置文件变更，支持备份和回滚<br>多环境部署，开发，测试，线上环境相互隔离<br>灰度推送配置<br>远程执行安全的命令<br>基本的统计功能<br>使用者操作流程如下：</p>
<p>创建主机组</p>
<p>主机组是需要批量部署同一个软件或者下发相同配置的主机的集合，创建主机组的同时需要关联一下配置模块，该配置模块是提前写好的puppet模块。</p>
<p>添加主机</p>
<p>将需要部署该模块的主机加入该组内（本系统中主机的输入源是cmdb接口）</p>
<p>选择环境</p>
<p>根据需求选择该主机的环境，各个环境的配置数据独立存储，彼此不受影响。</p>
<p>配置部署参数</p>
<p>根据配置模块不同，编写配置文件，生成不同的配置页面，业务运维只要在页面上选择相应的参数，puppet会根据这些参数生成相应的配置文件。</p>
<p>推送配置</p>
<p>业务运维再前端页面配置完成后，返回主机组管理页面，选择主机并进行推送配置，便会触发相关主机的puppet agent 运行，部署相应的软件和配置。</p>
<p>3.系统架构说明</p>
<p>AutoCMS使用django作为前端框架，后端部署程序主要基于puppet实现，通过puppet的enc和report功能实现完整的部署和配置逻辑，整体架构如下：</p>
<p>简要分析下：</p>
<p>前端配置页面<br>由于各个软件配置选项不同，所以前端的软件参数配置页面要采用配置文件动态生成。<br>数据存储<br>设计初期，我们在mysql和MongoDB之间选择了MongoDB，主要出于一下几点考虑：<br>Schema-less,json风格存储：由于配置数据根据软件的不同，其数据不能依靠key-value能够存放的，每个软件的配置项可能会有自定义的结构，所以采用了json格式来处理，而MongoDB的bson恰好能够满足需求，省去了在mysql中频繁使用外键。此外，json格式数据易于掌握和理解，存储的数据一目了然。</p>
<p>CRUD方便快捷，支持范围查询和正则查询，还支持支持upsert选项（如果不存在则插入）。</p>
<p>与其他nosql产品相比，我们对mongodb的持久化和高可用方案更加熟悉。</p>
<p>部署实施层</p>
<p>该部分是通过puppet模块实现，模块中引用的参数通过自定义facter或者使用enc来读取配置存储的MongoDB获得，</p>
<p>多实例部署的实现：<br>一台主机的多实例部署通过create_resources函数实现，例如一台主机需要配置多个tomcat实例，数据会是如下结构：  </p>
<p>多环境分离实现： 本系统中puppet代码部分有git作为版本控制，通过git自身的多分支的特性来做puppet代码层面的环境分离。根据需求来执行不同分支的puppet代码即可。<br>4.配置案例</p>
<p>下面以tomcat自动部署模块为例，进行详细介绍：</p>
<p>根据部署需求，设计出配置数参数的存储结构<br>填写前端布局的配置文件，自动生成前端配置页面。 </p>
<p>编写puppet自动部署模块。</p>
<p>编写enc转换程序<br>以上准备工作做好之后，系统上线，运维可以创建主机组，关联tomcat模块，将需要批量部署的主机加入该组内，并进行参数配置<br>配置完成后，进行灰度发布验证没问题后，进行全量推送，观察状态，配置完成。 </p>
<ol>
<li>小结</li>
</ol>
<p>随着云时代的到来，很多服务器可以定制镜像实现所需的运行环境，不过随着业务规模的扩大，服务器的个性化配置会越来越多，镜像的维护工作也会逐步增加，使用AutoCMS可以灵活的解决这个问题。把各自的配置需求写成配置模块，并把服务器分组，批量推送下去，可以节省运维人员很多体力劳动。让运维人员将精力投入到更有价值的工作中。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/soa/">soa</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-dubbox" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/04/28/dubbox/" class="article-date">
  	<time datetime="2016-04-28T09:26:34.000Z" itemprop="datePublished">2016-04-28</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/28/dubbox/">dubbox</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://github.com/dangdangdotcom/dubbox" target="_blank" rel="external">https://github.com/dangdangdotcom/dubbox</a><br>Dubbox now means Dubbo eXtensions. If you know java, javax and dubbo, you know what dubbox is :)<br>Dubbox adds features like RESTful remoting, Kyro/FST serialization, etc to the popular dubbo service framework. It’s been used by several projects of dangdang.com, which is one of the major e-commerce companies in China.<br>主要贡献者</p>
<p>沈理 当当网 shenli@dangdang.com<br>王宇轩 当当网 wangyuxuan@dangdang.com<br>马金凯 韩都衣舍 majinkai@handu.com<br>Dylan 独立开发者 dinguangx@163.com<br>Kangfoo 独立开发者<br>讨论QQ群：258792161 （不限于dubbox，包括SOA设计、互联网技术等等兴趣交流）<br>Dubbox当前的主要功能</p>
<p>支持REST风格远程调用（HTTP + JSON/XML)：基于非常成熟的JBoss RestEasy框架，在dubbo中实现了REST风格（HTTP + JSON/XML）的远程调用，以显著简化企业内部的跨语言交互，同时显著简化企业对外的Open API、无线API甚至AJAX服务端等等的开发。事实上，这个REST调用也使得Dubbo可以对当今特别流行的“微服务”架构提供基础性支持。 另外，REST调用也达到了比较高的性能，在基准测试下，HTTP + JSON与Dubbo 2.x默认的RPC协议（即TCP + Hessian2二进制序列化）之间只有1.5倍左右的差距，详见文档中的基准测试报告。<br>支持基于Kryo和FST的Java高效序列化实现：基于当今比较知名的Kryo和FST高性能序列化库，为Dubbo默认的RPC协议添加新的序列化实现，并优化调整了其序列化体系，比较显著的提高了Dubbo RPC的性能，详见文档中的基准测试报告。<br>支持基于Jackson的JSON序列化：基于业界应用最广泛的Jackson序列化库，为Dubbo默认的RPC协议添加新的JSON序列化实现。<br>支持基于嵌入式Tomcat的HTTP remoting体系：基于嵌入式tomcat实现dubbo的HTTP remoting体系（即dubbo-remoting-http），用以逐步取代Dubbo中旧版本的嵌入式Jetty，可以显著的提高REST等的远程调用性能，并将Servlet API的支持从2.5升级到3.1。（注：除了REST，dubbo中的WebServices、Hessian、HTTP Invoker等协议都基于这个HTTP remoting体系）。<br>升级Spring：将dubbo中Spring由2.x升级到目前最常用的3.x版本，减少版本冲突带来的麻烦。<br>升级ZooKeeper客户端：将dubbo中的zookeeper客户端升级到最新的版本，以修正老版本中包含的bug。<br>支持完全基于Java代码的Dubbo配置：基于Spring的Java Config，实现完全无XML的纯Java代码方式来配置dubbo<br>调整Demo应用：暂时将dubbo的demo应用调整并改写以主要演示REST功能、Dubbo协议的新序列化方式、基于Java代码的Spring配置等等。<br>修正了dubbo的bug 包括配置、序列化、管理界面等等的bug。<br>注：dubbox和dubbo 2.x是兼容的，没有改变dubbo的任何已有的功能和配置方式（除了升级了spring之类的版本）<br>文档资料</p>
<p>在Dubbo中开发REST风格的远程调用（RESTful Remoting）<br>在Dubbo中使用高效的Java序列化（Kryo和FST）<br>使用JavaConfig方式配置dubbox<br>Dubbo Jackson序列化使用说明<br>Demo应用简单运行指南<br>Dubbox@InfoQ<br>Dubbox Wiki （由社区志愿者自由编辑的）<br>版本</p>
<p>详见：<a href="https://github.com/dangdangdotcom/dubbox/releases" target="_blank" rel="external">https://github.com/dangdangdotcom/dubbox/releases</a><br>dubbox-2.8.0：主要支持REST风格远程调用、支持Kryo和FST序列化、升级了Spring和Zookeeper客户端、调整了demo应用等等<br>dubbox-2.8.1：主要支持基于嵌入式tomcat的http-remoting，优化了REST客户端性能，在REST中支持限制服务端接纳的最大HTTP连接数等等<br>dubbox-2.8.2：<br>支持REST中的HTTP logging，包括HTTP header的字段和HTTP body中的消息体，方便调试、日志纪录等等<br>提供辅助类便于REST的中文处理<br>改变使用@Reference annotation配置时的异常处理方式，即当用annotation配置时，过去dubbo在启动期间不抛出依赖服务找不到的异常，而是在具体调用时抛出NPE，这与用XML配置时的行为不一致。<br>较大的充实了Dubbo REST的文档<br>dubbox-2.8.3：<br>在REST中支持dubbo统一的方式用bean validation annotation作参数校验（沈理）<br>在RpcContext上支持获取底层协议的Request/Response（沈理）<br>支持采用Spring的Java Config方式配置dubbo（马金凯）<br>在Dubbo协议中支持基于Jackson的json序列化（Dylan）<br>在Spring AOP代理过的对象上支持dubbo annotation配置（Dylan）<br>修正Dubbo管理界面中没有consumer时出现空指针异常（马金凯）<br>修正@Reference annotation中protocol设置不起作用的bug（沈理）<br>修正@Reference annotation放在setter方法上即会出错的bug（Dylan）<br>依赖</p>
<p>从dubbox-2.8.4开始，所有依赖库的使用方式将和dubbo原来的一样：即如果要使用REST、Kyro、FST、Jackson等功能，需要用户自行手工添加相关的依赖。例如：<br>REST风格远程调用</p>
<dependency><br>    <groupid>org.jboss.resteasy</groupid><br>    <artifactid>resteasy-jaxrs</artifactid><br>    <version>3.0.7.Final</version><br></dependency><br><dependency><br>    <groupid>org.jboss.resteasy</groupid><br>    <artifactid>resteasy-client</artifactid><br>    <version>3.0.7.Final</version><br></dependency><br><dependency><br>    <groupid>javax.validation</groupid><br>    <artifactid>validation-api</artifactid><br>    <version>1.0.0.GA</version><br></dependency>

<!-- 如果要使用json序列化 -->
<dependency><br>    <groupid>org.jboss.resteasy</groupid><br>    <artifactid>resteasy-jackson-provider</artifactid><br>    <version>3.0.7.Final</version><br></dependency>

<!-- 如果要使用xml序列化 -->
<dependency><br>    <groupid>org.jboss.resteasy</groupid><br>    <artifactid>resteasy-jaxb-provider</artifactid><br>    <version>3.0.7.Final</version><br></dependency>

<!-- 如果要使用netty server -->
<dependency><br>    <groupid>org.jboss.resteasy</groupid><br>    <artifactid>resteasy-netty</artifactid><br>    <version>3.0.7.Final</version><br></dependency>

<!-- 如果要使用Sun HTTP server -->
<dependency><br>    <groupid>org.jboss.resteasy</groupid><br>    <artifactid>resteasy-jdk-http</artifactid><br>    <version>3.0.7.Final</version><br></dependency>

<!-- 如果要使用tomcat server -->
<p><dependency><br>    <groupid>org.apache.tomcat.embed</groupid><br>    <artifactid>tomcat-embed-core</artifactid><br>    <version>8.0.11</version><br></dependency></p>
<p><dependency><br>    <groupid>org.apache.tomcat.embed</groupid><br>    <artifactid>tomcat-embed-logging-juli</artifactid><br>    <version>8.0.11</version><br></dependency><br>Kyro序列化</p>
<p><dependency><br>    <groupid>com.esotericsoftware.kryo</groupid><br>    <artifactid>kryo</artifactid><br>    <version>2.24.0</version><br></dependency></p>
<p><dependency><br>    <groupid>de.javakaffee</groupid><br>    <artifactid>kryo-serializers</artifactid><br>    <version>0.26</version><br></dependency><br>FST序列化</p>
<p><dependency><br>    <groupid>de.ruedigermoeller</groupid><br>    <artifactid>fst</artifactid><br>    <version>1.55</version><br></dependency><br>Jackson序列化</p>
<p><dependency><br>    <groupid>com.fasterxml.jackson.core</groupid><br>    <artifactid>jackson-core</artifactid><br>    <version>2.3.3</version><br></dependency></p>
<p><dependency><br>    <groupid>com.fasterxml.jackson.core</groupid><br>    <artifactid>jackson-databind</artifactid><br>    <version>2.3.3</version><br></dependency><br>FAQ（暂存）</p>
<p>Dubbox需要什么版本的JDK？</p>
<p>目前最好在JDK 1.7以上运行<br>Dubbo REST的服务能和Dubbo注册中心、监控中心集成吗？</p>
<p>可以的，而且是自动集成的，也就是你在dubbo中开发的所有REST服务都会自动注册到服务册中心和监控中心，可以通过它们做管理。<br>但是，只有当REST的消费端也是基于dubbo的时候，注册中心中的许多服务治理操作才能完全起作用。而如果消费端是非dubbo的，自然不受注册中心管理，所以其中很多操作是不会对消费端起作用的。<br>Dubbo REST中如何实现负载均衡和容错（failover）？</p>
<p>如果dubbo REST的消费端也是dubbo的，则Dubbo REST和其他dubbo远程调用协议基本完全一样，由dubbo框架透明的在消费端做load balance、failover等等。<br>如果dubbo REST的消费端是非dubbo的，甚至是非java的，则最好配置服务提供端的软负载均衡机制，目前可考虑用LVS、HAProxy、 Nginx等等对HTTP请求做负载均衡。<br>JAX-RS中重载的方法能够映射到同一URL地址吗？</p>
<p><a href="http://stackoverflow.com/questions/17196766/can-resteasy-choose-method-based-on-query-params" target="_blank" rel="external">http://stackoverflow.com/questions/17196766/can-resteasy-choose-method-based-on-query-params</a><br>JAX-RS中作POST的方法能够接收多个参数吗？</p>
<p><a href="http://stackoverflow.com/questions/5553218/jax-rs-post-multiple-objects" target="_blank" rel="external">http://stackoverflow.com/questions/5553218/jax-rs-post-multiple-objects</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/soa/">soa</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 菜菜
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>